---
layout : post
category : programming language
tags : [Programming language]
---

# 编程语言原理(第10版)  


## 第7章 表达式与赋值语句

---

### 7.1 概述

* 问题：
	*  表达式中运算符的运算顺序，是由语言的结合性与优先级规则规定的。
		* 语言的设计者往往没有声明表达式中操作数的运算顺序。
		* 故允许实现者选择该顺序，从而导致程序在不同的执行下可能得出不同的结果。
	* 类型不匹配、强制转换和短路求值
* 命令式编程语言的本质在于赋值语句的主导地位。
	* 赋值语句的目的是改变变量的值或程序的状态。
	* 这种变量值随着程序的执行而改变的概念，是所有命令式语言中不可或缺的一部分。	

---

### 7.2 算术表达式

*  在编程语言中，算术表达式的多数特点都来源于在数学中形成的惯例
*  在编程语言中，算术表达式由运算符、操作数、括号和函数调用组成。
*  算术运算表达式的目的在于说明一个算术计算。执行一个这样的计算必将引起两个操作：
	* 取出操作数（通常是从存储器中去除）；
	* 对这些操作数进行算术运算。
* 基本设计问题 ：
	* 运算符的优先级规则是什么？
	* 运算符的结合性规则是什么？
	* 操作数的运算顺序是什么？
	* 对操作数求值的副作用是否存在约束？
	* 语言是否允许用户自定义重载运算符？
	* 在表达式中，可以怎样混合类型？ 

#### 7.2.1 运算符的运算顺序

##### 7.2.1.1 优先级

*  将运算符置于一套运算优先级的等级制度下，并在一定程度上基于这一等级制度来决定表达式的运算顺序，而不是简单地按从左向右或从右向左的顺序对运算符进行运算。
*  表达式求值中，运算符的优先级规则定义了优先级不同的运算符的运算顺序。
*  在常见的命令式语言中，运算符的优先级规则几乎完全一样，因为它们都源于数学上的规则：
	* 幂运算的优先级是最高的，
	* 次之是优先级相同的乘、除运算，
	* 再次之是优先级相同的二元加法和二元减法 
* 一元加法，称为恒等算子，因为它一般没有关联的操作，对操作数没有任何作用
* 一元减法会改变操作数的符号
	* 一元减法运算符可以出现在表达式的开头或表达式中的任何位置，只要用括号将它和相邻的运算符分开 

|优先级|Ruby|基于C的语言|
|-
|最高|**（幂）|后缀++、--|
||一元运算符+、-|前缀++、--、一元运算符+、-|
||*、 /、 %|*、 /、 %|
|最低|二元运算符+、-|二元运算符+、-|

##### 7.2.1.2 结合性	

*  当表达式中两个优先级相同的运算符相邻时，先运算哪个运算符的问题就由语言的结合性规则来决定。
	* 若两个运算符仅由一个操作数隔开，则称这两个运算符符相邻
	* 常见语言的结合性是从左到右的，但幂运算符的结合性有时是从右向左。

|结合规则|Ruby|基于C的语言|Ada|
|-
|左结合|*、 /、 +、-|*、 /、 %、二元运算符+、-|除**之外的所有运算符
|右结合|**|++、--、一元运算符+、-|
|无结合|||**

*  遗憾的是，在计算机里，浮点的表示法和浮点的算术运算都只是其数学上的近似（由于空间限制）。数学运算符具有结合性，并不意味着对应的浮点运算也具有结合性。

##### 7.2.1.3 括号

* 在表达式中，括号中的部分的优先级较其相邻的非括号中的部分要高	

##### 7.2.1.4 Ruby表达式

*  Ruby是一种纯粹的面向对象语言，也就是说，每个数据值，包括字面值，都是对象。
* 在表达式领域，Ruby与基于C的语言的不同之处在于，所有的算术、关系和赋值运算，以及数组索引、移位和逐位逻辑运算，都实现为方法。
* 例如 a+b, 表示调用a引用的对象之方法+, 传递的参数是b所引用的对象。
* 运算符重载，重写，重定义

##### 7.2.1.5 LISP中的表达式

*  要在LISP中指定C表达式 a+b*c
	* (+a (* b c))
	* 在这个表达式中 + 和 *都是函数名

##### 7.2.1.6 条件表达式

*  表达式1 ？表达式2 ：表达式3

#### 7.2.2 操作数的运算顺序

##### 7.2.2.1 副作用

*  当函数改变其参数或者全局变量时，我们就说函数是有**副作用**的（全局变量在函数外声明，但是可以由函数访问）。
*  数学里的函数没有副作用，因为数学中没有变量的概念。函数式编程语言也没有这个问题。
*  对于操作数的运算顺序以及副作用问题，有两种解决办法。
	* 其一是语言的设计者可以禁止函数带有副作用，来防止函数的计算影响到表达式的值
	* 其二是语言的定义中规定表达式中操作数的运算顺序，并要求实现者按该顺序实现。

##### 7.2.2.2 引用透明和副作用

*  在程序中，如果任意两个值相同的表达式能够在该程序的任何地方互换，并且不影响程序的运行，这个**程序**就是引用透明的，
*  引用透明使程序中的函数等价于一个数学函数。

---

### 7.3 运算符重载

*  运算符的多种用法叫做运算符重载。
*  危险例子
	* & 
		* 二元运算符，两个二进制数的按位逻辑AND运算
		* 一元运算符，取变量的地址
	* -减号
		*  二元
		* 一元
* C++ 有几个运算符不能重载，类结构成员运算符(.)和域解析运算符(::)

---

### 7.4 类型转换

*  类型转换分为收缩转换和扩展转换：
	* 收缩转换将一个类型的值转换为另一个类型，新的类型甚至不能存下原类型数据的几乎所有值
	* 扩展转换将一个类型的值转换为另一个类型，新的类型至少能存下原类型几乎所有值。
*  虽然扩展转换通常是安全的，但是它可能降低精度。
	* 例如，很多情况下，整数是用32个bit来存储的，其精度至少是9位数字。
	* 浮点数同样用32个bit来存，但其精度只有7位数字（因为要有存储指数的空间）
	* 因此，整数到浮点数的扩展会损失2位精度

#### 7.4.1 表达式中的强制类型转换

*  可以有不同类型的操作数的表达式称为**混合模式表达式**

#### 7.4.2 显式类型转换

#### 7.4.3 表达式中的错误

---

### 7.5 关系表达式和布尔表达式

#### 7.5.1 关系表达式

#### 7.5.2 布尔表达式

---

### 7.6 短路求值

---

### 7.7 赋值语句

#### 7.7.1 简单赋值

#### 7.7.2 条件赋值

#### 7.7.3 混合赋值运算符

#### 7.7.4 一元赋值运算符

#### 7.7.5 赋值表达式

#### 7.7.6 多重赋值

#### 7.7.7 函数式编程语言中的赋值


---

### 7.8 混合模式赋值
